<!DOCTYPE html>
<meta charset="utf-8">
<style>

</style>
<body>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>
        var width = 960,
                height = 1160;

        var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);

        d3.json("map.json", function(error, mapData) {
                if (error) {return console.error(error);}

                console.log(mapData);


                var projection = d3.geo.mercator();
                var mexico;
                var path = d3.geo.path().projection(projection);
                var massachusetts = topojson.feature(mapData,mapData.objects.MA);

                console.log(massachusetts);

                projection.scale(1).translate([0,0]);

                var b = path.bounds(massachusetts);
                var s = .95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1]-b[0][1])/height);
                var t = [(width - s* (b[1][0]+ b[0][0]))/2, (height - s* (b[1][1] + b[0][1]))/2];

                projection.scale(s).translate(t);

                var map= svg.append("g").attr("class","boundary");

                mexico = map.selectAll("path").data(massachusetts.features);

                var click = function(d) {
                        mexico.attr("fill-opacity", 0.2)
                                .attr("stroke","pink");
                        d3.select(this).attr("fill-opacity", 1);
                }

                mexico.enter()
                        .append("path")
                        .attr("d",path)
                        .on("click",click);

                var color =d3.scale.linear().domain([0,300]).range(["red","yellow"]);

                mexico.attr("fill",function(d,i){return color(i)});
                mexico.attr("stroke","coral");

                var dataPoint =[{"name":"Dartmouth","lat":"41.602310","lon":"-70.941900"},{"name":"Assonet","lat":"41.797910","lon":"-71.074570"},
                        {"name":"Boston","lat":"42.3583333","lon":"-71.0602778"},{"name":"Worcester","lat":"42.2625","lon":"-71.8027778"}];
                var cityPoints = svg.selectAll("circle").data(dataPoint);
                var cityText= svg.selectAll("text").data(dataPoint);
                cityPoints.enter()
                        .append("circle")
                        .attr("cx",function(d){return projection([d.lon, d.lat])[0]})
                        .attr("cy",function(d){return projection([d.lon, d.lat])[1]})
                        .attr("r",4)
                        .attr("fill","steelblue");
                cityText.enter()
                        .append("text")
                        .attr("x",function(d){return projection([d.lon, d.lat])[0]})
                        .attr("y",function(d){return projection([d.lon, d.lat])[1]})
                        .attr("dx",5)
                        .attr("dy",3)
                        .text(function(d){return d.name});


        });

</script>

</body>
